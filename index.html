
<!DOCTYPE html>
<html lang="tr" data-theme="dark" style=""><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reel Getiri Analiz Platformu</title>

    <!-- PWA Manifest -->
    <link rel="manifest" id="manifest-link" href="blob:https://www.genspark.ai/17e6258a-6c02-43f3-a7db-7de98243dde2">

    <!-- Theme -->
    <meta name="theme-color" content="#00ff88">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Modern Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;family=JetBrains+Mono:wght@400;500;600&amp;display=swap" rel="stylesheet">

    <style>
      :root {
        /* Ultra Modern Color Palette */
        --bg-primary: #0a0a0a;
        --bg-secondary: #111111;
        --bg-card: rgba(255, 255, 255, 0.03);
        --bg-glass: rgba(255, 255, 255, 0.05);
        --text-primary: #ffffff;
        --text-secondary: #a1a1aa;
        --text-muted: #71717a;

        /* Neon Colors */
        --neon-green: #00ff88;
        --neon-blue: #00d4ff;
        --neon-purple: #8b5cf6;
        --neon-pink: #f472b6;
        --neon-orange: #fb923c;

        /* Gradients */
        --gradient-primary: linear-gradient(135deg, var(--neon-green) 0%, var(--neon-blue) 100%);
        --gradient-secondary: linear-gradient(135deg, var(--neon-purple) 0%, var(--neon-pink) 100%);
        --gradient-bg: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);

        /* Light Theme */
        --bg-primary-light: #ffffff;
        --bg-secondary-light: #f8fafc;
        --bg-card-light: rgba(0, 0, 0, 0.02);
        --bg-glass-light: rgba(0, 0, 0, 0.03);
        --text-primary-light: #0f172a;
        --text-secondary-light: #475569;
        --text-muted-light: #64748b;

        /* Spacing */
        --space-xs: 0.5rem;
        --space-sm: 1rem;
        --space-md: 1.5rem;
        --space-lg: 2rem;
        --space-xl: 3rem;
        --space-2xl: 4rem;
        --space-3xl: 6rem;

        /* Border Radius */
        --radius-sm: 0.5rem;
        --radius-md: 1rem;
        --radius-lg: 1.5rem;
        --radius-xl: 2rem;

        /* Shadows */
        --shadow-glow: 0 0 20px rgba(0, 255, 136, 0.3);
        --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.3);
        --shadow-card: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      [data-theme='light'] {
        --bg-primary: var(--bg-primary-light);
        --bg-secondary: var(--bg-secondary-light);
        --bg-card: var(--bg-card-light);
        --bg-glass: var(--bg-glass-light);
        --text-primary: var(--text-primary-light);
        --text-secondary: var(--text-secondary-light);
        --text-muted: var(--text-muted-light);
        --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          'Inter',
          -apple-system,
          BlinkMacSystemFont,
          system-ui,
          sans-serif;
        background: var(--gradient-bg);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
      }

      [data-theme='light'] body {
        background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 50%, #e2e8f0 100%);
      }

      /* Animated Background */
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
          radial-gradient(circle at 20% 50%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 40% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
        animation: backgroundFlow 20s ease-in-out infinite;
        z-index: -1;
      }

      @keyframes backgroundFlow {
        0%,
        100% {
          opacity: 0.3;
        }
        50% {
          opacity: 0.6;
        }
      }

      /* Theme Toggle */
      .theme-toggle {
        position: fixed;
        top: 2rem;
        right: 2rem;
        z-index: 1000;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        padding: 0.75rem;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--text-primary);
        font-size: 1.25rem;
      }

      .theme-toggle:hover {
        background: var(--bg-card);
        transform: scale(1.05);
      }

      /* Main Container */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: var(--space-lg);
        position: relative;
        z-index: 1;
      }

      /* Hero Section */
      .hero {
        text-align: center;
        padding: var(--space-3xl) 0;
        margin-bottom: var(--space-2xl);
      }

      .hero h1 {
        font-size: clamp(3rem, 8vw, 6rem);
        font-weight: 900;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: var(--space-md);
        letter-spacing: -0.02em;
        line-height: 0.9;
      }

      .hero .subtitle {
        font-size: clamp(1.25rem, 3vw, 1.75rem);
        color: var(--text-secondary);
        font-weight: 400;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.4;
      }

      /* Glass Card */
      .glass-card {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-xl);
        padding: var(--space-2xl);
        margin-bottom: var(--space-lg);
        box-shadow: var(--shadow-glass);
        position: relative;
        overflow: hidden;
      }

      [data-theme='light'] .glass-card {
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .glass-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: var(--gradient-primary);
      }

      /* Form Styling */
      .form-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: var(--space-lg);
        margin-bottom: var(--space-xl);
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
      }

      .form-group label {
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: var(--space-xs);
      }

      .form-group input {
        padding: 1.25rem 1.5rem;
        background: var(--bg-card);
        border: 2px solid transparent;
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: 1.125rem;
        font-weight: 500;
        font-family: 'JetBrains Mono', monospace;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .form-group input:focus {
        outline: none;
        border-color: var(--neon-green);
        box-shadow: 0 0 0 4px rgba(0, 255, 136, 0.1);
        background: var(--bg-glass);
      }

      .form-group input::placeholder {
        color: var(--text-muted);
      }

      /* Modern Button */
      .btn-primary {
        grid-column: 1 / -1;
        padding: 1.5rem 3rem;
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-size: 1.25rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: var(--shadow-glow);
      }

      .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      /* Loading Animation */
      .loader {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: var(--space-2xl);
        gap: var(--space-md);
        color: var(--text-secondary);
      }

      .loader.hidden {
        display: none;
      }

      .spinner {
        width: 3rem;
        height: 3rem;
        border: 3px solid var(--bg-card);
        border-top: 3px solid var(--neon-green);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loader span {
        font-size: 1.125rem;
        font-weight: 500;
      }

      /* Notification */
      .notification {
        background: rgba(0, 255, 136, 0.1);
        border: 1px solid var(--neon-green);
        border-radius: var(--radius-md);
        padding: var(--space-md);
        margin: var(--space-lg) 0;
        color: var(--neon-green);
        font-weight: 500;
        display: none;
      }

      /* Results Grid */
      .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: var(--space-lg);
        margin-top: var(--space-xl);
      }

      /* Result Cards */
      .result-card {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-lg);
        padding: var(--space-xl);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      [data-theme='light'] .result-card {
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .result-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-card);
      }

      .result-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-primary);
      }

      .result-card h3 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--space-md);
        line-height: 1.2;
      }

      .result-card p {
        color: var(--text-secondary);
        margin-bottom: var(--space-sm);
        font-size: 1rem;
        line-height: 1.5;
      }

      .result-card p strong {
        color: var(--text-primary);
        font-weight: 600;
        font-family: 'JetBrains Mono', monospace;
        font-size: 1.1em;
      }

      /* Performance Indicators */
      .performance-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--space-xs);
        padding: var(--space-md) var(--space-lg);
        border-radius: var(--radius-md);
        font-weight: 700;
        font-size: 1.5rem;
        text-align: center;
        margin-top: var(--space-md);
        width: 100%;
        justify-content: center;
        font-family: 'JetBrains Mono', monospace;
      }

      .performance-badge.positive {
        background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(34, 197, 94, 0.2) 100%);
        border: 2px solid var(--neon-green);
        color: var(--neon-green);
      }

      .performance-badge.negative {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
        border: 2px solid #ef4444;
        color: #ef4444;
      }

      /* Section Headers */
      .section-header {
        grid-column: 1 / -1;
        text-align: center;
        padding: var(--space-xl);
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-lg);
        margin: var(--space-xl) 0;
        position: relative;
        overflow: hidden;
      }

      [data-theme='light'] .section-header {
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .section-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--gradient-secondary);
      }

      .section-header h2 {
        font-size: 2.5rem;
        font-weight: 800;
        background: var(--gradient-secondary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: var(--space-sm);
      }

      .section-header p {
        color: var(--text-secondary);
        font-size: 1.125rem;
        max-width: 600px;
        margin: 0 auto;
      }

      /* Breakeven Cards */
      .breakeven-card {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-lg);
        padding: var(--space-xl);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      [data-theme='light'] .breakeven-card {
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .breakeven-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-card);
      }

      .breakeven-card.above {
        border-left: 4px solid var(--neon-green);
      }

      .breakeven-card.below {
        border-left: 4px solid var(--neon-orange);
      }

      .status-indicator {
        display: inline-flex;
        align-items: center;
        gap: var(--space-xs);
        padding: var(--space-sm) var(--space-md);
        border-radius: var(--radius-sm);
        font-weight: 600;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-top: var(--space-sm);
      }

      .status-indicator.positive {
        background: rgba(0, 255, 136, 0.15);
        color: var(--neon-green);
      }

      .status-indicator.warning {
        background: rgba(251, 146, 60, 0.15);
        color: var(--neon-orange);
      }

      .explanation-box {
        margin-top: var(--space-md);
        padding: var(--space-md);
        background: var(--bg-card);
        border-radius: var(--radius-sm);
        border-left: 3px solid var(--neon-blue);
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.6;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .container {
          padding: var(--space-md);
        }

        .hero {
          padding: var(--space-xl) 0;
        }

        .glass-card {
          padding: var(--space-lg);
        }

        .form-container {
          grid-template-columns: 1fr;
          gap: var(--space-md);
        }

        .results-grid {
          grid-template-columns: 1fr;
          gap: var(--space-md);
        }

        .theme-toggle {
          top: 1rem;
          right: 1rem;
        }
      }

      @media (max-width: 480px) {
        .hero h1 {
          font-size: 2.5rem;
        }

        .form-group input {
          padding: 1rem;
          font-size: 1rem;
        }

        .btn-primary {
          padding: 1.25rem 2rem;
          font-size: 1rem;
        }

        .result-card {
          padding: var(--space-lg);
        }
      }

      /* Color utility classes */
      .text-success {
        color: var(--neon-green) !important;
      }
      .text-error {
        color: #ef4444 !important;
      }
      .text-warning {
        color: var(--neon-orange) !important;
      }
      .text-primary {
        color: var(--text-primary) !important;
      }
      .text-secondary {
        color: var(--text-secondary) !important;
      }

      /* Animation for cards appearing */
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .result-card {
        animation: slideUp 0.6s ease-out;
      }

      .result-card:nth-child(even) {
        animation-delay: 0.1s;
      }

      .result-card:nth-child(odd) {
        animation-delay: 0.2s;
      }
    </style>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Open%20Sans:wght@400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto%20Sans%20JP:wght@400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400&amp;display=swap" rel="stylesheet"></head>
  <body style="">
    <!-- Theme Toggle -->
    <div class="theme-toggle" onclick="toggleTheme()">🌓</div>

    <div class="container">
      <!-- Hero Section -->
      <section class="hero">
        <h1>Reel Getiri Analizi</h1>
        <p class="subtitle">Yatırımınızın enflasyon ve döviz karşısındaki gerçek performansını ölçün</p>
      </section>

      <!-- Input Form -->
      <div class="glass-card">
        <form id="analysis-form">
          <div class="form-container">
            <div class="form-group">
              <label for="alis-tarihi">Alış Tarihi</label>
              <input type="date" id="alis-tarihi" required="" max="2025-09-15">
            </div>
            <div class="form-group">
              <label for="alis-fiyati">Alış Fiyatı (TL)</label>
              <input type="number" id="alis-fiyati" placeholder="1.000.000" required="">
            </div>
            <div class="form-group">
              <label for="satis-tarihi">Satış Tarihi</label>
              <input type="date" id="satis-tarihi" required="" max="2025-09-15">
            </div>
            <div class="form-group">
              <label for="satis-fiyati">Satış Fiyatı (TL)</label>
              <input type="number" id="satis-fiyati" placeholder="3.000.000" required="">
            </div>
            <button type="submit" id="analyze-button" class="btn-primary">Analiz Et</button>
          </div>
        </form>
      </div>

      <!-- Notification Area -->
      <div id="notification-area" class="notification"></div>

      <!-- Loading Indicator -->
      <div id="loader" class="loader hidden">
        <div class="spinner"></div>
        <span>Veriler hesaplanıyor...</span>
      </div>

      <!-- Results Section -->
      <div id="results-container" class="results-grid">
        <!-- Results will be dynamically inserted here -->
      </div>
    </div>

    <!-- JavaScript (Unchanged from original) -->
    <script>
      // Theme Toggle Function
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      }

      // Load saved theme
      document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
      });

      // Original JavaScript functionality (unchanged)
      document.addEventListener('DOMContentLoaded', () => {
        // Gerekli DOM elemanlarını seçme
        const form = document.getElementById('analysis-form');
        const alisTarihiInput = document.getElementById('alis-tarihi');
        const alisFiyatiInput = document.getElementById('alis-fiyati');
        const satisTarihiInput = document.getElementById('satis-tarihi');
        const satisFiyatiInput = document.getElementById('satis-fiyati');
        const loader = document.getElementById('loader');
        const resultsContainer = document.getElementById('results-container');
        const notificationArea = document.getElementById('notification-area');
        const analyzeButton = document.getElementById('analyze-button');

        const apiCache = new Map();
        const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes

        // Tarih inputlarına varsayılan değerler ata ve gelecekteki tarihleri engelle
        const today = new Date();
        const todayString = today.toISOString().split('T')[0];

        satisTarihiInput.value = todayString;
        alisTarihiInput.setAttribute('max', todayString);
        satisTarihiInput.setAttribute('max', todayString);

        const oneYearAgo = new Date();
        oneYearAgo.setFullYear(today.getFullYear() - 1);
        const oneYearAgoString = oneYearAgo.toISOString().split('T')[0];
        alisTarihiInput.value = oneYearAgoString;

        const API_URL =
          'https://script.google.com/macros/s/AKfycbxTWH3iXuFQRUo-ZpXAWy4y5SiPXwytJPDtsKI7LtbmdvhteAUMWRPdFp_IdjC58CGo/exec';

        // Form gönderildiğinde çalışacak fonksiyon
        form.addEventListener('submit', (event) => {
          event.preventDefault();

          // Girdi değerlerini al
          const alisTarihi = alisTarihiInput.value;
          const alisFiyati = parseFloat(alisFiyatiInput.value);
          const satisTarihi = satisTarihiInput.value;
          const satisFiyati = parseFloat(satisFiyatiInput.value);

          // Girdi doğrulama
          if (!alisTarihi || !alisFiyati || !satisTarihi || !satisFiyati) {
            alert('Lütfen tüm alanları doldurun.');
            return;
          }

          if (alisFiyati <= 0 || satisFiyati <= 0) {
            alert('Fiyatlar sıfırdan büyük olmalıdır.');
            return;
          }

          if (new Date(satisTarihi) < new Date(alisTarihi)) {
            alert('Satış tarihi, alış tarihinden önce olamaz.');
            return;
          }

          // Tarihleri hafta sonu için düzelt
          notificationArea.style.display = 'none';
          const adjustedAlisDate = getPreviousWeekday(new Date(alisTarihi + 'T12:00:00Z'));
          const adjustedSatisDate = getPreviousWeekday(new Date(satisTarihi + 'T12:00:00Z'));

          const adjustedAlisTarihiString = adjustedAlisDate.toISOString().split('T')[0];
          const adjustedSatisTarihiString = adjustedSatisDate.toISOString().split('T')[0];

          // Eğer tarih değiştiyse kullanıcıyı bilgilendir ve inputları güncelle
          if (alisTarihi !== adjustedAlisTarihiString || satisTarihi !== adjustedSatisTarihiString) {
            notificationArea.textContent =
              'Not: Seçtiğiniz tarih hafta sonuna denk geldiği için analiz en yakın iş gününe göre yapılmıştır.';
            notificationArea.style.display = 'block';
            alisTarihiInput.value = adjustedAlisTarihiString;
            satisTarihiInput.value = adjustedSatisTarihiString;
          }

          // API'ye istek gönderme
          fetchDataAndAnalyze(adjustedAlisTarihiString, alisFiyati, adjustedSatisTarihiString, satisFiyati);
        });

        function getPreviousWeekday(date) {
          const day = date.getUTCDay();
          if (day === 0) {
            date.setUTCDate(date.getUTCDate() - 2);
          } else if (day === 6) {
            date.setUTCDate(date.getUTCDate() - 1);
          }
          return date;
        }

        async function fetchDataAndAnalyze(alisTarihi, alisFiyati, satisTarihi, satisFiyati) {
          analyzeButton.disabled = true;
          analyzeButton.textContent = 'Analiz Ediliyor...';

          loader.classList.remove('hidden');
          resultsContainer.innerHTML = '';

          const cacheKey = `${alisTarihi}-${satisTarihi}`;
          const cachedData = apiCache.get(cacheKey);

          if (cachedData && Date.now() - cachedData.timestamp < CACHE_DURATION) {
            console.log('Using cached data');
            displayResults(cachedData.data, alisFiyati, satisFiyati);
            loader.classList.add('hidden');
            analyzeButton.disabled = false;
            analyzeButton.textContent = 'Analiz Et';
            return;
          }

          const formData = new FormData();
          formData.append('alisTarihi', formatDateForAPI(alisTarihi));
          formData.append('satisTarihi', formatDateForAPI(satisTarihi));

          try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 second timeout

            const response = await fetch(API_URL, {
              method: 'POST',
              body: formData,
              redirect: 'follow',
              signal: controller.signal,
            });

            clearTimeout(timeoutId);

            if (!response.ok) {
              throw new Error(`API Hatası: ${response.statusText}`);
            }

            const data = await response.json();

            apiCache.set(cacheKey, {
              data: data,
              timestamp: Date.now(),
            });

            displayResults(data, alisFiyati, satisFiyati);
          } catch (error) {
            console.error('API çağrısı sırasında bir hata oluştu:', error);
            if (error.name === 'AbortError') {
              resultsContainer.innerHTML = `<p class="text-error">İstek zaman aşımına uğradı. Lütfen tekrar deneyin.</p>`;
            } else {
              resultsContainer.innerHTML = `<p class="text-error">Veriler alınırken bir hata oluştu. Lütfen daha sonra tekrar deneyin.</p>`;
            }
          } finally {
            loader.classList.add('hidden');
            analyzeButton.disabled = false;
            analyzeButton.textContent = 'Analiz Et';
          }
        }

        function displayResults(data, alisFiyati, satisFiyati) {
          resultsContainer.innerHTML = '';

          if (!data.alis_verileri || !data.satis_verileri) {
            resultsContainer.innerHTML = `<p class="text-error">API'den eksik veri geldi. Seçtiğiniz tarihler için veri bulunamıyor olabilir.</p>`;
            return;
          }

          const assets = [
            { key: 'Altın Ortalama', name: 'Altın', unit: 'gr Altın' },
            { key: 'usd/tl', name: 'ABD Doları', unit: 'USD' },
            { key: 'euro/tl', name: 'Euro', unit: 'EUR' },
            { key: 'bist', name: 'BIST 100 Endeksi', unit: 'Puan' },
            { key: 'gyo endeks', name: 'GYO Endeksi', unit: 'Puan' },
            { key: 'TÜFE ENDEKS', name: 'Enflasyon (TÜFE)', unit: 'TL (Enflasyona Göre)' },
          ];

          const fragment = document.createDocumentFragment();

          assets.forEach((asset) => {
            const alisKuru = data.alis_verileri[asset.key];
            const satisKuru = data.satis_verileri[asset.key];

            if (!alisKuru || !satisKuru || alisKuru === 0 || satisKuru === 0) {
              return;
            }

            let alisDegeri, satisDegeri;

            if (asset.key === 'TÜFE ENDEKS') {
              alisDegeri = alisFiyati;
              satisDegeri = satisFiyati * (alisKuru / satisKuru);
            } else {
              alisDegeri = alisFiyati / alisKuru;
              satisDegeri = satisFiyati / satisKuru;
            }

            const karZarar = satisDegeri - alisDegeri;
            const karZararClass = karZarar >= 0 ? 'text-success' : 'text-error';
            const karZararPrefix = karZarar >= 0 ? '+' : '';

            const yuzdelikDegisim = ((satisDegeri - alisDegeri) / alisDegeri) * 100;
            const yuzdelikPrefix = yuzdelikDegisim >= 0 ? '+' : '';
            const yuzdelikClass = yuzdelikDegisim >= 0 ? 'positive' : 'negative';

            const cardDiv = document.createElement('div');
            cardDiv.className = 'result-card';
            cardDiv.innerHTML = `
                        <h3>${asset.name} Karşılığı Performans</h3>
                        <p>Alış Değeri: <strong>${formatNumber(alisDegeri, asset.key)} ${asset.unit}</strong></p>
                        <p>Satış Değeri: <strong>${formatNumber(satisDegeri, asset.key)} ${asset.unit}</strong></p>
                        <p class="${karZararClass}">
                            ${karZarar >= 0 ? 'Kâr' : 'Zarar'}: <strong>${karZararPrefix}${formatNumber(karZarar, asset.key)} ${asset.unit}</strong>
                        </p>
                        <div class="performance-badge ${yuzdelikClass}">
                            ${yuzdelikPrefix}${yuzdelikDegisim.toFixed(2)}% ${yuzdelikDegisim >= 0 ? 'Kazanç' : 'Kayıp'}
                        </div>
                    `;
            fragment.appendChild(cardDiv);
          });

          const breakEvenSection = document.createElement('div');
          breakEvenSection.className = 'section-header';
          breakEvenSection.innerHTML = `
                    <h2>Başa Baş Noktaları</h2>
                    <p>Aşağıdaki değerler, yatırımınızın her bir varlık karşısında başa baş çıkması için gereken minimum satış fiyatlarını göstermektedir.</p>
                `;
          fragment.appendChild(breakEvenSection);

          assets.forEach((asset) => {
            const alisKuru = data.alis_verileri[asset.key];
            const satisKuru = data.satis_verileri[asset.key];

            if (!alisKuru || !satisKuru || alisKuru === 0 || satisKuru === 0) {
              return;
            }

            let breakEvenPrice;
            let explanation;

            if (asset.key === 'TÜFE ENDEKS') {
              // Enflasyon için başa baş: alış fiyatı * (satış TÜFE / alış TÜFE)
              breakEvenPrice = alisFiyati * (satisKuru / alisKuru);
              explanation = `Enflasyona karşı değer kaybetmemek için minimum ${formatNumber(breakEvenPrice)} TL'ye satış yapmalısınız.`;
            } else {
              // Diğer varlıklar için başa baş: alış fiyatı * (satış kuru / alış kuru)
              breakEvenPrice = alisFiyati * (satisKuru / alisKuru);
              explanation = `${asset.name} karşısında başa baş çıkmak için minimum ${formatNumber(breakEvenPrice)} TL'ye satış yapmalısınız.`;
            }

            const currentPrice = parseFloat(satisFiyatiInput.value) || 0;
            const isAboveBreakEven = currentPrice >= breakEvenPrice;
            const statusClass = isAboveBreakEven ? 'positive' : 'warning';
            const cardClass = isAboveBreakEven ? 'above' : 'below';
            const statusText = isAboveBreakEven ? 'Başa Baş Üzerinde' : 'Başa Baş Altında';
            const statusIcon = isAboveBreakEven ? '✓' : '⚠';

            const breakEvenCard = document.createElement('div');
            breakEvenCard.className = `breakeven-card ${cardClass}`;
            breakEvenCard.innerHTML = `
                        <h3>${asset.name} Başa Baş Noktası</h3>
                        <p><strong>Başa Baş Fiyatı:</strong> ${formatNumber(breakEvenPrice)} TL</p>
                        <p><strong>Mevcut Satış Fiyatı:</strong> ${formatNumber(currentPrice)} TL</p>
                        <div class="status-indicator ${statusClass}">
                            ${statusIcon} ${statusText}
                        </div>
                        <div class="explanation-box">
                            ${explanation}
                        </div>
                    `;
            fragment.appendChild(breakEvenCard);
          });

          resultsContainer.appendChild(fragment);
        }

        function formatDateForAPI(dateString) {
          const [year, month, day] = dateString.split('-');
          return `${day}.${month}.${year}`;
        }

        function formatNumber(number, key) {
          const options = {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          };
          if (key === 'TÜFE ENDEKS') {
            return number.toLocaleString('tr-TR', options);
          }
          return number.toLocaleString('tr-TR', options);
        }
      });
    </script>

    <!-- PWA Setup (Unchanged from original) -->
    <script>
      // 1. Manifest dosyasını dinamik olarak oluştur ve bağla
      const manifest = {
        short_name: 'Reel Getiri',
        name: 'Reel Getiri Analiz Platformu',
        start_url: '.',
        display: 'standalone',
        theme_color: '#00ff88',
        background_color: '#0a0a0a',
        description: 'Gayrimenkul yatırımlarınızın reel getirisini analiz eden PWA.',
      };

      try {
        const manifestString = JSON.stringify(manifest);
        const manifestBlob = new Blob([manifestString], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-link').setAttribute('href', manifestUrl);
      } catch (error) {
        console.warn('Manifest oluşturulamadı:', error);
      }

      // 2. Service Worker'ı kaydet
      if ('serviceWorker' in navigator) {
        const swCode = `
                const CACHE_NAME = 'reel-getiri-analiz-v3';
                const urlsToCache = ['/'];

                self.addEventListener('install', event => {
                  event.waitUntil(
                    caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
                  );
                });

                self.addEventListener('fetch', event => {
                  event.respondWith(
                    caches.match(event.request).then(response => {
                      return response || fetch(event.request);
                    })
                  );
                });

                self.addEventListener('activate', event => {
                    const cacheWhitelist = [CACHE_NAME];
                    event.waitUntil(
                        caches.keys().then(cacheNames => {
                            return Promise.all(
                                cacheNames.map(cacheName => {
                                    if (cacheWhitelist.indexOf(cacheName) === -1) {
                                        return caches.delete(cacheName);
                                    }
                                })
                            );
                        })
                    );
                });
            `;

        try {
          const swBlob = new Blob([swCode], { type: 'application/javascript' });
          const swUrl = URL.createObjectURL(swBlob);

          window.addEventListener('load', () => {
            navigator.serviceWorker
              .register(swUrl)
              .then((registration) => {
                console.log('ServiceWorker kaydı başarılı: ', registration.scope);
              })
              .catch((error) => {
                console.log('ServiceWorker kaydı başarısız: ', error);
              });
          });
        } catch (error) {
          console.warn('Service Worker oluşturulamadı:', error);
        }
      }
    </script>
  

</body></html>
